{% extends 'layouts/base.html' %}

{% block content %}

<div class="template-container">
    <h1 class="page-title">{{ title }}</h1>

    <div class="search-bar"><!-- Search bar -->
        <form method="GET" action="">
            {{ form.b_reservation }}
            <button type="submit" class="save-btn">Search</button>
            <button type="button" onclick="window.location.href='{% url 'reservations' %}'" class="save-btn">Clear search</button>
        </form>
    </div>

    <div class="date-search-bar"><!-- Search bar for reservations by date -->
        <form method="GET" action="">
            {{ form_dates.start_date.label_tag }}
            {{ form_dates.start_date }}
            {{ form_dates.end_date.label_tag }}
            {{ form_dates.end_date }}
            <button type="submit" class="save-btn">Search by date</button>
            <button type="button" onclick="window.location.href='{% url 'reservations' %}'" class="save-btn">Clear search</button>
        </form>
    </div>

    <table class="table-container"><!-- Table with all reservations on db -->
        <thead>
            <tr>
                <th><a href="?sort={% if request.GET.sort == 'customer' %}-customer{% else %}customer{% endif %}">Customer</a></th>
                <th><a href="?sort={% if request.GET.sort == 'table' %}-table{% else %}table{% endif %}">Table</a></th>
                <th><a href="?sort={% if request.GET.sort == 'guests' %}-guests{% else %}guests{% endif %}">Guests</a></th>
                <th><a href="?sort={% if request.GET.sort == 'date' %}-date{% else %}date{% endif %}">Date</a></th>
                <th><a href="?sort={% if request.GET.sort == 'promoter' %}-promoter{% else %}promoter{% endif %}">Promoter</a></th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for reservation in reservations %}
            <tr>
                <td>{{ reservation.customer }}</td>
                <td>{{ reservation.table }}</td>
                <td>{{ reservation.guests }}</td>
                <td>{{ reservation.date|date:"d/m/Y" }}</td>
                <td>{{ reservation.promoter }}</td>
                {% if user == reservation.user or user.is_superuser %}
                <td><!-- Form to edit or delete reservation -->
                    <a href="{% url 'edit_reservation' reservation.id %}" class="edit-item">Edit</a>
                </td>
                <td>
                    <form method="POST" action="{% url 'delete_reservation' reservation.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="delete-item bi bi-trash" onclick="return confirmDelete()"></button>
                    </form>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- Button for a new reservation -->
    <a href="{% url 'new_reservation' %}" class="btn-cd">New reservation</a>
</div>
<!-- Script to confirm delete -->
<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this reservation?");
    }
</script>

{% endblock %}